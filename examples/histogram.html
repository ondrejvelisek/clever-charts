<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/4.8.0/d3.min.js"></script>
    <script src="../dist/clever-charts-1.2.5.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"/>
</head>

<style>
    .zoom-control {
        margin-left:100px;
    }

    .graphs-ct {
        margin-top:15px;
        display: none;
    }
</style>

<body>
    <input type="checkbox" class="change-selection-control">Disable bucket</button>
    <input type="checkbox" class="zoom-control">Zoom</button>
    <input type="checkbox" class="invert-control">Invert</button>
    <br>
    <div class="graphs-ct"></div>
    <script>
        // histogram 1 (default selection) ================================================================
        var histogram = new CleverCharts.Histogram({
            width:360,
            format:".0f",
            promptHandler:(value)=>{
                return new Promise((success)=>{
                    var result = prompt("Sample prompt handler", value);
                    if (result !== null) {
                        success(result);
                    }
                })
            },
            height:150
        });

        histogram.render(".graphs-ct");

        var sampleSelection = [
            {"from":-5,"to":100,"disabled":false,"colors": ["#CD22D2", "#55a3ec"],"opacity":0.1},
            {"from":100,"to":200,"disabled":false,"colors":["#CD22D2", "#55a3ec"],"opacity":0.3},
            {"from":200,"to":300,"disabled":false,"colors":["#CD22D2", "#55a3ec"],"opacity":0.5},
            {"from":300,"to":421,"disabled":false,"colors":["#CD22D2", "#55a3ec"],"opacity":0.7}
        ];

        d3.json("data/histogram/sample-compare.json", (json) => {
            histogram.setData(json.content,sampleSelection);  
        });

        d3.select(".change-selection-control").on("click", function(){
            sampleSelection[0].disabled = this.checked;
            histogram.setSelection(sampleSelection);
        });                   

        histogram.on("selectionOver", (selectionIndex)=>{
            console.log("histogram 1: selectionOver:"+selectionIndex);
        });

        histogram.on("toggleSelection", (selectionIndex, enabled, event)=>{
            console.log("histogram 1: toggleSelection:"+selectionIndex+", enabled:"+enabled);
            console.log("SHIFT: ", event.shiftKey);
        });

        histogram.on("selectionChanged", (selection)=>{
            console.log("histogram 1: selectionChanged:"+JSON.stringify(selection, null, 4));
        });

        histogram.on("handleClick", (handleIndex, handleValue, ev)=>{
            console.log("histogram 1: handleClick: index: "+handleIndex+", value: "+handleValue);
        });

        // histogram 2 (filter) ==================================================================================
        var histogram2 = new CleverCharts.Histogram({
            width:360,
            height:150,
            format:".0f",
            selectionType:CleverCharts.Histogram.SelectionTypes.FILTER
        });

        histogram2.render(".graphs-ct");

        d3.json("data/histogram/sample2.json", (json) => {
            histogram2.setData(json.content, [{
                from:9591,
                to:20310
            }]);

            d3.select(".graphs-ct").style("display","block");
        });

        histogram2.on("selectionOver", (selectionIndex)=>{
            console.log("histogram 2: selectionOver:"+selectionIndex);
        });

        histogram2.on("toggleSelection", (selectionIndex, enabled)=>{
            console.log("histogram 2: toggleSelection:"+selectionIndex+", enabled:"+enabled);

        });        

        histogram2.on("selectionChanged", (selection)=>{
            console.log("histogram 2: selectionChanged:"+JSON.stringify(selection, null, 4));
        });        

        histogram2.on("handleClick", (handleIndex, handleValue)=>{
            console.log("histogram 2: handleClick:"+handleIndex+", value: "+handleValue);
        });        

        // simulate zoom
        d3.select(".zoom-control").on("click", function(){
            if (this.checked){
                d3.json("data/histogram/sample2-zoom.json", (json) => {
                    histogram2.setData(json.content, [{
                        from:9591,
                        to:20310
                    }],
                    {
                        animate:true
                    });
                });
            } else {
                d3.json("data/histogram/sample2.json", (json) => {
                    histogram2.setData(json.content, [{
                        from:9591,
                        to:20310
                    }],{
                        animate:true
                    });
                });
            }
        }).on("mouseover", function(){
            histogram2.showSelectionLabels();
        }).on("mouseout", function(){
            histogram2.hideSelectionLabels();
        }); 

        // simulate invert
        d3.select(".invert-control").on("click", function(){
            if (this.checked){
                histogram2.setSelectionType(CleverCharts.Histogram.SelectionTypes.INVERTED_FILTER);
                
            } else {
                histogram2.setSelectionType(CleverCharts.Histogram.SelectionTypes.FILTER);
            }
        });


        // histogram 3, 4 (update selection) ================================================================
        var histogram3 = new CleverCharts.Histogram({
            width:360,
            format:".0f",
            height:150
        });
        var histogram4 = new CleverCharts.Histogram({
            width:360,
            format:".0f",
            height:150
        });

        histogram3.render(".graphs-ct");
        histogram4.render(".graphs-ct");

        var sampleSelection34 = [
            {"from":-5,"to":100,"disabled":false,"color": "#55a3ec","opacity":0.1},
            {"from":100,"to":200,"disabled":false,"color":"#55a3ec","opacity":0.3},
            {"from":200,"to":300,"disabled":false,"color":"#55a3ec","opacity":0.5},
            {"from":300,"to":421,"disabled":false,"color":"#55a3ec","opacity":0.7}
        ];

        d3.json("data/histogram/sample.json", (json) => {
            histogram3.setData(json.content,sampleSelection34);
            histogram4.setData(json.content,sampleSelection34);
        });

        histogram3.on("selectionOver", (selectionIndex)=>{
            histogram3.setSelection(highlightedSelection(sampleSelection34, selectionIndex));
            histogram4.setSelection(highlightedSelection(sampleSelection34, selectionIndex));
        });

        histogram4.on("selectionOver", (selectionIndex)=>{
            histogram3.setSelection(highlightedSelection(sampleSelection34, selectionIndex));
            histogram4.setSelection(highlightedSelection(sampleSelection34, selectionIndex));
        });

        function highlightedSelection(selection, index) {
            return selection.map((sel, i) => (i === index ? {...sel, color: "#ff0000", opacity: 1} : sel));
        }
    </script>
</body>